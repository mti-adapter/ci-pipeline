steps:
  - name: ":junit: Run tests"
    command: ".ci/go/tests.sh"
    artifact_paths: "dist/*"
    plugins:
      - docker-compose#v3.5.0:
          config: .ci/pipeline-go-service-docker-compose.yml
          run: agent
          env:
            - PROJECT
            - BUILDKITE_JOB_ID
            - BUILDKITE_BUILD_ID
            - BUILDKITE_BUILD_NUMBER

  - wait

  - name: ":golang: Build & Package Artifacts"
    command: ".ci/go/build.sh"
    artifact_paths: "dist/*"
    plugins:
      - docker-compose#v3.5.0:
          config: .ci/pipeline-go-service-docker-compose.yml
          run: agent
          env:
            - PROJECT
            - BUILDKITE_JOB_ID
            - BUILDKITE_BUILD_ID
            - BUILDKITE_BUILD_NUMBER

  - wait

  - name: ":docker: Build & Publish Docker Image"
    command: ".ci/go/build-docker-image.sh"
